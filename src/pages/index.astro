---
import "../styles/global.css";
import FarmaciaTurno from "../components/main";
import { getFarmaciaByDate } from "../lib/generarTurnos";
import Analytics from "@vercel/analytics/astro";

// Zona horaria de Argentina para todos los c√°lculos
const AR_TIME_ZONE = "America/Argentina/Buenos_Aires";

// Obtener la fecha actual en hora Argentina
const now = new Date();

// Formatear la fecha en espa√±ol argentino con zona horaria correcta
const fechaFormateada = new Intl.DateTimeFormat("es-AR", {
  timeZone: AR_TIME_ZONE,
  weekday: "long",
  year: "numeric",
  month: "long",
  day: "numeric",
}).format(now);

// Obtener datos de la farmacia de turno para SEO (ya usa zona horaria AR internamente)
const farmacia = getFarmaciaByDate(now);

// Metadatos SEO optimizados
const title = `Farmacia de Turno Hoy en Monte Caseros | ${farmacia.nombre}`;
// Meta descripci√≥n optimizada (<160 caracteres para SEO)
const description = `${farmacia.nombre} - Farmacia ${farmacia.trabajando ? "trabajando" : "de turno"} hoy en Monte Caseros, Corrientes. Informaci√≥n actualizada.`;
const url = "https://farmaciadeturnomc.site";
const imageUrl = `${url}/og-image.png`;

// Estructura de datos JSON-LD para Google y Asistentes de IA
const jsonLdLocalBusiness = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  name: `${farmacia.nombre} - ${farmacia.trabajando ? "Farmacia Trabajando" : "Farmacia de Turno"}`,
  description: `${farmacia.trabajando ? "Farmacia trabajando" : "Farmacia de turno"} en Monte Caseros, Corrientes. ${description}`,
  address: {
    "@type": "PostalAddress",
    addressLocality: "Monte Caseros",
    addressRegion: "Corrientes",
    addressCountry: "AR",
    streetAddress: farmacia.direccion || "Monte Caseros",
  },
  telephone: farmacia.telefono || "",
  url: url,
  openingHours: farmacia.trabajando ? "Mo-Su 20:00-08:00" : "Mo-Su 20:00-08:00",
  priceRange: "$$",
  category: "Farmacia",
  areaServed: {
    "@type": "City",
    name: "Monte Caseros",
  },
  geo: {
    "@type": "GeoCoordinates",
    latitude: -30.2539,
    longitude: -57.6363,
  },
};

// Schema WebSite para mejor indexaci√≥n
const jsonLdWebSite = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "Farmacias de Turno Monte Caseros",
  url: url,
  description: "Consulta qu√© farmacia est√° de turno hoy en Monte Caseros, Corrientes. Informaci√≥n actualizada diariamente con direcciones y tel√©fonos.",
  inLanguage: "es-AR",
  potentialAction: {
    "@type": "SearchAction",
    target: {
      "@type": "EntryPoint",
      urlTemplate: url
    },
    "query-input": "required name=search_term_string"
  }
};

// Schema Organization
const jsonLdOrganization = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Farmacias de Turno Monte Caseros",
  url: url,
  logo: `${url}/favicon.ico`,
  description: "Servicio de informaci√≥n de farmacias de turno en Monte Caseros, Corrientes",
  address: {
    "@type": "PostalAddress",
    addressLocality: "Monte Caseros",
    addressRegion: "Corrientes",
    addressCountry: "AR"
  },
  areaServed: {
    "@type": "City",
    name: "Monte Caseros"
  }
};

// Schema FAQPage - muy importante para asistentes de IA
const jsonLdFAQ = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: [
    {
      "@type": "Question",
      name: "¬øQu√© farmacia est√° de turno hoy en Monte Caseros?",
      acceptedAnswer: {
        "@type": "Answer",
        text: `Hoy ${fechaFormateada} la farmacia de turno en Monte Caseros, Corrientes es ${farmacia.nombre}. ${farmacia.estadoMensaje}. Direcci√≥n: ${farmacia.direccion || "Monte Caseros"}. Tel√©fono: ${farmacia.telefono || "Disponible"}.`
      }
    },
    {
      "@type": "Question",
      name: "¬øC√≥mo saber qu√© farmacia est√° de turno en Monte Caseros?",
      acceptedAnswer: {
        "@type": "Answer",
        text: `Puedes consultar qu√© farmacia est√° de turno en Monte Caseros visitando ${url}. La informaci√≥n se actualiza diariamente y muestra la farmacia de turno actual con su direcci√≥n y n√∫mero de tel√©fono.`
      }
    },
    {
      "@type": "Question",
      name: "¬øQu√© farmacia trabaja hoy en Monte Caseros, Corrientes?",
      acceptedAnswer: {
        "@type": "Answer",
        text: `La farmacia que trabaja hoy en Monte Caseros es ${farmacia.nombre}. ${farmacia.trabajando ? "Est√° trabajando" : "Est√° de turno"} con turno hasta ${farmacia.estadoMensaje}. Direcci√≥n: ${farmacia.direccion || "Monte Caseros"}. Tel√©fono: ${farmacia.telefono || "Disponible"}.`
      }
    }
  ]
};
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    <meta
      name="google-site-verification"
      content="OM-qTTuo-3uV6ntBQz2c7-X_emVm_Dy85aMhwTPy_Rk"
    />

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta
      name="keywords"
      content="farmacia de turno, monte caseros, corrientes, farmacia, turno, medicamentos, farmacia hoy, farmacia abierta, monte caseros farmacia, farmacia trabajando, turno nocturno"
    />
    <meta name="author" content="Gonzalo Ramirez" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="es" />
    <meta name="geo.region" content="AR-W" />
    <meta name="geo.placename" content="Monte Caseros" />
    <meta name="geo.position" content="-30.2539;-57.6363" />
    <meta name="ICBM" content="-30.2539, -57.6363" />
    
    <!-- Meta tags adicionales para asistentes de IA -->
    <meta name="topic" content="Farmacias de Turno, Monte Caseros, Corrientes" />
    <meta name="subject" content="Informaci√≥n de farmacias de turno en Monte Caseros" />
    <meta name="classification" content="Servicio de informaci√≥n de salud" />
    <meta name="coverage" content="Monte Caseros, Corrientes, Argentina" />

    <!-- Canonical URL -->
    <link rel="canonical" href={url} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={url} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={imageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="es_AR" />
    <meta property="og:site_name" content="Farmacias de Turno Monte Caseros" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={url} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={imageUrl} />

    <!-- Additional SEO -->
    <meta name="theme-color" content="#16a34a" />
    <meta name="msapplication-TileColor" content="#16a34a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Farmacias de Turno MC" />

    <!-- Preconnect para mejorar performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- JSON-LD Structured Data para SEO y Asistentes de IA -->
    <script type="application/ld+json" set:html={JSON.stringify(jsonLdWebSite)} />
    <script type="application/ld+json" set:html={JSON.stringify(jsonLdOrganization)} />
    <script type="application/ld+json" set:html={JSON.stringify(jsonLdLocalBusiness)} />
    <script type="application/ld+json" set:html={JSON.stringify(jsonLdFAQ)} />

    <!-- Sitemap hint -->
    <link
      rel="sitemap"
      type="application/xml"
      title="Sitemap"
      href="/sitemap.xml"
    />

    <Analytics />
  </head>
  <body class="relative bg-white min-h-screen w-full">
    <!-- Fondo de cuadr√≠cula -->
    <div
      class="absolute inset-0 -z-10 h-full w-full bg-white bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px]"
    >
    </div>

    <!-- Contenido principal -->
    <main class="relative z-10">
        <!-- H1 expl√≠cito para SEO - visible en el HTML inicial -->
        <header class="text-center pt-4 sm:pt-6 pb-3 sm:pb-4 px-3 sm:px-4 relative z-10" role="banner">
          <div class="flex items-center justify-center gap-2 sm:gap-3 mb-2 sm:mb-3">
            <div class="relative">
              <span class="text-4xl sm:text-5xl" role="img" aria-label="Hospital">
                üè•
              </span>
            </div>
          </div>
          <h1 class="text-2xl sm:text-3xl md:text-7xl font-black bg-gradient-to-r from-green-600 via-emerald-500 to-green-700 bg-clip-text text-transparent tracking-tight leading-tight">
            ¬°Farmacia de Turno Hoy!
            <span class="block text-lg sm:text-2xl md:text-5xl mt-1 sm:mt-2">
              Monte Caseros
            </span>
          </h1>
          <p class="text-green-700 font-medium capitalize text-sm sm:text-lg mt-2 sm:mt-4" role="contentinfo">
            {fechaFormateada}
          </p>
        </header>
        
        <FarmaciaTurno
          client:load
          farmacia={farmacia}
          fechaFormateada={fechaFormateada}
        />
    </main>
  </body>
</html>
